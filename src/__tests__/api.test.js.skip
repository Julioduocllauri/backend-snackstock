import { describe, it, expect } from 'vitest';
import request from 'supertest';
import app from '../app.js';

describe('API Endpoints (functional tests)', () => {
  describe('GET /api', () => {
    it('debería responder con status 200 o 404', async () => {
      const response = await request(app).get('/api');
      
      // Puede ser 200 o 404 dependiendo de si hay una ruta raíz
      expect([200, 404]).toContain(response.status);
    });
  });

  describe('POST /api/auth/register', () => {
    it('debería fallar con datos inválidos (sin mock de DB)', async () => {
      const response = await request(app)
        .post('/api/auth/register')
        .send({
          name: '',
          email: 'email-invalido',
          password: '123',
        });

      // Esperamos error de validación o error de servidor
      expect(response.status).toBeGreaterThanOrEqual(400);
    });
  });

  describe('POST /api/auth/login', () => {
    it('debería fallar con credenciales vacías', async () => {
      const response = await request(app)
        .post('/api/auth/login')
        .send({
          email: '',
          password: '',
        });

      // Esperamos error
      expect(response.status).toBeGreaterThanOrEqual(400);
    });
  });
});
